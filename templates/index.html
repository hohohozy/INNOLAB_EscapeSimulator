<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Fire Evacuation Simulator</title>
    <style>
        body { font-family: sans-serif; }
        #map { 
            display: grid; 
            grid-template-columns: repeat(9, 30px); 
            grid-template-rows: repeat(9, 30px); 
            gap: 2px; 
            margin-top: 10px; 
            position: relative; 
        }
        .cell { 
            width: 30px; 
            height: 30px; 
            text-align: center; 
            font-size: 14px; 
            line-height: 30px; 
        }

        /* Color Markings */
        .empty { background: #eee; }
        .fire { background: red; color: white; }
        .evacuee { background: blue; color: white; font-weight: bold; }
        .person { background: green; color: white; }
        .trapped { background: gray; color: white; }
        .stairs { background: yellow; }
        .exit { background: orange; }
        .wall { background: black; }
        .medical { background: lightblue; }
        .extinguisher { background: purple; color: white; }
        .path { background: cyan; opacity: 0.5; }
        .moving { background: pink; transition: all 0.5s ease-in-out; }
    </style>
</head>
<body>
    <h1>üî• Fire Evacuation Simulator</h1>
    <button onclick="toggleAuto()">‚èØ Auto Simulation</button>
    <button onclick="nextStep()">‚è≠ Next Step</button>

    <div id="status">
        <p>Turn: <span id="turn">0</span></p>
        <p>Escaped: <span id="escaped">0</span></p>
        <p>Trapped: <span id="trapped">0</span></p>
    </div>

    <div id="map"></div>

    <script>
        let evacueePosition = {x: 0, y: 0};  // Main character position
        let people = [];  // Array to store positions of all people
        let fireZones = [];  // Fire zone positions
        let path = [];  // Main character's escape path
        let turn = 0;  // Turns counter
        let autoSimulation = false;  // Toggle auto simulation

        function updateStatus() {
            document.getElementById('turn').innerText = turn;
            document.getElementById('escaped').innerText = people.filter(p => p.type === 'escaped').length;
            document.getElementById('trapped').innerText = people.filter(p => p.type === 'trapped').length;
        }

        function renderMap() {
            const map = document.getElementById('map');
            map.innerHTML = '';  // Clear any existing map content

            // 1. Render grid
            for (let y = 0; y < 9; y++) {
                for (let x = 0; x < 9; x++) {
                    const cell = document.createElement('div');
                    cell.classList.add('cell', 'empty');
                    const pos = [x, y];

                    // Render fire, walls, extinguishers, etc.
                    if (fireZones.some(p => p[0] === x && p[1] === y)) cell.classList.add('fire');
                    if (walls.some(p => p[0] === x && p[1] === y)) cell.classList.add('wall');
                    if (medicalPoints.some(p => p[0] === x && p[1] === y)) cell.classList.add('medical');
                    if (extinguishers.some(p => p[0] === x && p[1] === y)) cell.classList.add('extinguisher');
                    if (STAIRS.some(p => p[0] === x && p[1] === y)) cell.classList.add('stairs');
                    if (EXIT_LOCATIONS.some(p => p[0] === x && p[1] === y)) cell.classList.add('exit');

                    // Append to map
                    cell.style.gridColumnStart = x + 1;
                    cell.style.gridRowStart = y + 1;
                    map.appendChild(cell);
                }
            }

            // 2. Render escape path for the main character
            if (path.length > 0) {
                path.forEach(step => {
                    const pathCell = document.createElement('div');
                    pathCell.classList.add('cell', 'path');
                    pathCell.style.gridColumnStart = step[0] + 1;
                    pathCell.style.gridRowStart = step[1] + 1;
                    map.appendChild(pathCell);
                });
            }

            // 3. Render the main character's current position
            const evacueeCell = document.createElement('div');
            evacueeCell.classList.add('cell', 'moving');
            evacueeCell.style.gridColumnStart = evacueePosition.x + 1;
            evacueeCell.style.gridRowStart = evacueePosition.y + 1;
            map.appendChild(evacueeCell);
        }

        function nextStep() {
            // Simulate next step in evacuation process
            turn++;
            // Update status and path for the main character
            updateStatus();
            renderMap();
        }

        function toggleAuto() {
            autoSimulation = !autoSimulation;
            if (autoSimulation) {
                // Auto simulation logic goes here
                setInterval(nextStep, 1000);
            }
        }

        // Initialization
        function initSimulation() {
            // Fetch the initial simulation data from the server
            fetch('/').then(response => response.json()).then(data => {
                evacueePosition = data.evacuations.main_character;
                fireZones = data.fire_zones;
                people = data.people;
                renderMap();
            });
        }

        initSimulation();
    </script>
</body>
</html>
